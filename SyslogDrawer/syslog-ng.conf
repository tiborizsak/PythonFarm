@version: 7.0
#Default configuration file for syslog-ng.
#
# For a description of syslog-ng configuration file directives, please read
# the syslog-ng Administrator's guide at:
#
# https://www.balabit.com/support/documentation
#
#@include "removeme.conf"
@include "scl.conf"
@include "rewritemark.conf"
#@include "humioforward.conf"
@include "humioforward-cp.conf"
##@include "humioforward-admin.conf.conf.conf"
@include "drop_windows_seclogs.conf"    # added leroy isaac 7/16/2020
@include "cyber-f5lb.conf"
#@include "network.conf" 	# commented out with the retirement of the cenralized log server TEBMCME-5872 - Feb 2023
@include "cyber-ciscoasa-12514.conf"
@include "cyber-forti-11514.conf"
@include "cyber-forcepoint-11515.conf"
@include "cyber-zscaler-10515.conf"
@include "cyber-mcafeeids-5114.conf"
@include "cyber-bcproxy-10514.conf"
#@include "debug.conf"
@include "vbc_debug.conf"  #### NEED TO CHECK WITH LEROY
#@include "replaynetwork.conf"   Turn this on when you want to replay an event to test Alerting
#@include "netapp.conf"  # commented out with the retirement of the cenralized log server TEBMCME-5872 - Feb 2023
###@include "loadbal.conf"
#@include "itda-forward.conf"
#@include "elk-forward-9092.conf"
@include "cyber-ping-13527.conf"      # added leroy isaac 7/9/2020 - tecmwfa-1213
@include "venafi-sysng.conf"
@include "tspsalerting.conf"
@include "tsps-windows.conf"
@include "tsps-legacyloginsight.conf" # Jud Oct 16/2020 migration from Log Insight
@include "tsps-legacyloginsight2.conf" 	# leroy isaac Nov 23, 2020
@include "collect_tspslogs.conf"        # leroy isaac Aug  8, 2020
@include "cyber-trend.conf"
@include "cyber-Pinnacle-13539.conf"
@include "OBC-alert.conf"
@include "WPI-alert.conf"
@include "HCI-alert.conf"
@include "RDM-alert.conf"
@include "AOX-alert.conf"
@include "ANG-alert.conf"
@include "LDI-alert.conf"
@include "HAS-alert.conf"
@include "CLP-alert.conf"
@include "CHT-alert.conf"
@include "CCD-alert.conf"
@include "CPO-alert.conf"
@include "MPX-alert.conf"
@include "HCA-alert.conf"
@include "CKM-alert.conf"
@include "ICE-alert.conf"
@include "EDC-alert.conf"
@include "OCP-alert.conf"
@include "MNY-alert.conf"
@include "BDP-alert.conf"
@include "mqs-alert.conf"
@include "MDM-alert.conf"
@include "SEP-alert.conf"
@include "PSG-alert.conf"
#@include "CMK-alert.conf"
@include "PRT-alert.conf"
@include "PAY-alert.conf"
@include "MPC-alert.conf"
@include "CFO-alert.conf"
@include "ESI-alert.conf"
@include "PVS-alert.conf"
@include "UCR-alert.conf"	#	leroy isaac - Dec 2021 - TEBMCME-5041
@include "RSS-alert.conf"            # Tom Anderson added 12/16/2020 for testing

options {
        keep-hostname(yes);
        chain-hostnames(no);
        use-dns(yes);
        dns-cache(yes);
        dns-cache-size(16000);
        dns-cache-expire(21600);
        normalize-hostnames(yes);
	stats_freq(3600);
        stats-level(1);
        flush-lines(1000);
        threaded(yes);
        log-fifo-size(500000);
};

######
# sources

source s_local {
# message generated by Syslog-NG
  system();
};

# added 4/1/18 for internal
source s_internal {
  internal();
};

source s_network_tcp {
        network(
                port(601)#
                transport(tcp)
                max-connections(25000)
                log-fetch-limit(30000)
                log-iw-size(25000000)
		so-keepalive(yes)
        );
        network(
                port(514)
                transport(tcp)
		log-msg-size(5000)
		encoding(utf-8)
                max-connections(1000)
		so-keepalive(yes)
                log-iw-size(1000000)
        );

};

source s_network_udp {
	udp-balancer(
                port(514)
                transport(udp)
                max-connections(5000)
                log-fetch-limit(1000)
                log-iw-size(500000)
                so-rcvbuf(268435456)
        );
};

# filters
filter f_messages { level(info..emerg) and not facility(authpriv,cron,mail); };
#filter f_debug { level(debug); };
filter f_authpriv { facility(authpriv); };
filter f_auth { facility(auth); };
filter f_cron { facility(cron); };
filter f_mail { facility(mail); };
filter f_spooler      { facility(uucp,news) and level(crit); };
filter f_local7       { facility(local7); };
filter f_auth_combined { filter(f_authpriv) or filter(f_auth); };
filter f_ssh { program("sshd"); };
# added 4/1/18 to prevent debug from being sent over the network
filter f_debug_not { not level(debug); };


######
# destinations
destination d_network_tcp {
    network(
    	# loginsight-qa.pncint.net
        "10.146.84.44"
        port(514)
        transport(tcp)
        disk-buffer(
                disk-buf-size(322122547200)
                )
        );
};

destination d_network_udp {
    network(
    	# loginsight-qa.pncint.net
        "10.146.84.44"
        #"10.10.199.123" 
        port(514)
        transport(udp)
        disk-buffer(
                disk-buf-size(322122547200)
                qout-size(500)
                )
        );
};


destination d_log {
    network(
        "llog235a.qa.pncint.net"
        port(514)
        transport(tcp)
        disk-buffer(
                disk-buf-size(322122547200)
                qout-size(500)
                )
        );
};

destination d_log601 {
    network(
        "llog235a"
        port(601)
        transport(tcp)
        disk-buffer(
                disk-buf-size(322122547200)
                qout-size(500)
                )
        );
};

# added 4/1/18 for internal syslog-ng logs
destination d_internal {
        file("/opt/syslog-ng/var/sysng-internal-${WEEKDAY}.log"
        overwrite-if-older(28800)
        perm(0640) dir_perm(0770)); };


# testing leroy - 11/20/2017 - Remove any message with userid for zenoss
#filter f_no_match_zenoss { not message("XSMRGZenoss"); };

destination d_message {file("/var/log/messages" perm(0644));};
#destination d_debug { file("/var/log/debug" perm(0644)); };
destination d_secure { file("/var/log/secure" perm(0600)); };
destination d_cron { file("/var/log/cron" perm(0644)); };
destination d_maillog { file("/var/log/maillog" perm(0640)); };
destination d_bootlog { file("/var/log/boot.log" perm(0600)); };
destination d_spooler { file("/var/log/spooler" perm(0640)); };

#REMOTE LOGGING DESTINATION ON RELAY

destination d_logtodisk {file("/opt/syslog-ng/midrange/${HOST}/${HOST}-${HOUR}.log" overwrite-if-older(3600) perm(0640) create-dirs(yes)); };

#logpath
log {
#  source(s_network_tcp);
  source(s_local);
  source(s_internal);
  #filter(f_no_match_zenoss);
  # added 4/1/18 to block debug logs from network destinations
 # filter(f_debug_not);
#  destination(d_logtodisk);
  #destination(d_log);
  #destination(d_elasticsearch_httplbqalinux);
  destination(d_logscale_httplbqalinux);
  flags(flow-control);
};

# commented out with the retirement of the cenralized log server TEBMCME-5872 - Feb 2023
#log {
#  source(s_network_udp);
#  # added 4/1/18 to block debug logs from network destinations
#  
# # filter(f_debug_not);
#  destination(d_network_udp);
#  #destination(d_logtodisk);
#  #destination(d_log);
#  flags(flow-control);
#};

#locally stored
log { source(s_local); filter(f_messages); destination(d_message); };
#log { source(s_local); filter(f_debug); destination(d_debug); };
log { source(s_local); filter(f_authpriv); destination(d_secure); };
log { source(s_local); filter(f_cron); destination(d_cron); };
log { source(s_local); filter(f_mail); destination(d_maillog); };
log { source(s_local); filter(f_local7); destination(d_bootlog); };
log { source(s_local); filter(f_spooler); destination(d_spooler); };

# added 4/13/18 to separate internal from the messages file
log { source(s_internal); destination(d_internal); };

source s_auditd { 
  linux-audit(
  filename("/var/log/audit/audit.log"));
};

# commented out with the retirement of the cenralized log server TEBMCME-5872 - Feb 2023
#log {
#  source(s_auditd);
#  destination(d_network_tcp);
#};
